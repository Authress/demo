<template>
  <nav id="navbar" class="navbar navbar-expand-lg navbar-light bg-secondary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <svg class="logo" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="36px" viewBox="0 0 1223.32 424.9" xml:space="preserve">
            <path class="logost0" d="M633.04,168.35v-0.01H602.5c-7.11,0-13.87,1.5-20,4.17V68.34h-30v150v40v70h30.54v-105c0-13.81,11.19-25,25-25
          h18.91c13.81,0,25,11.19,25,25v105h30.54v-110C682.5,190.91,660.41,168.65,633.04,168.35z" />
            <g>
              <path class="logost0" d="M737.5,223.34L737.5,223.34c0-13.5,10.71-24.5,24.09-24.98v-0.02h45.36v-30h-49.44c-0.01,0-0.01,0-0.02,0
            c-27.61,0-50,22.39-50,50v110h30V223.34z" />
            </g>
            <path class="logost0" d="M527.5,207.34v-30h-45v-109h-30v109h-12v30h12v51c0,38.66,31.34,70,70,70c1.68,0,3.35-0.08,5-0.2v-29.8
          c-24.85,0-45-20.15-45-45v-46H527.5z" />
            <path class="logost0" d="M889.45,168.34L889.45,168.34c-38.66,0-70,31.34-70,70v20c0,38.66,31.34,70,70,70l0,0h48.36v-30h-43.36
          c-21.42,0-40.32-15.96-44.87-36h59.79v-28h-59.79c4.55-20.04,23.46-36,44.87-36h43.36v-30H889.45z" />
            <g>
              <g>
                <path class="logost0" d="M336.77,328.38v-30.56c-11.27-2.42-19.73-12.44-19.73-24.44v-105H286.5v110c0,27.43,22.09,49.69,49.46,49.99
              v0.01H336.77z" />
                <path class="logost0" d="M385.96,168.38v105c0,12-8.45,22.02-19.73,24.44v30.56h0.82v-0.01c27.36-0.29,49.46-22.55,49.46-49.99v-110
              H385.96z" />
              </g>
              <circle class="logost0" cx="351.5" cy="314.03" r="7.5" />
            </g>
            <path class="logost0" d="M1061.26,239.98c-1.17-0.43-2.47-0.79-3.86-1.1c-8.77-3.64-40.34-7.84-49.58-9.63c-8.13-1.57-15-7.71-15-16
          c0-8.28,6.71-14.99,14.98-15h46.02v-30h-45.95c-0.02,0-0.03,0-0.05,0c-0.01,0-0.03,0-0.04,0h-0.8v0.02
          c-24.46,0.45-44.16,20.41-44.16,44.98c0,22.8,16.97,40.63,38.96,43.58c0,0,0,0,0,0.01c0,0,23.52,3.43,34.54,5.41
          c11.02,1.98,18.5,8.83,18.5,18.5c0,9.66-8.83,17.5-18.5,17.5c-0.01,0-0.01,0-0.02,0h-45.87c0,0,0,0,0,0H978.3
          c-0.16-0.01-0.32-0.03-0.48-0.03c-8.29,0-15,6.72-15,15c0,8.29,6.71,15,15,15v0.03h54.92c1.18,0.08,2.38,0.14,3.58,0.14
          c27.61,0,50-22.38,50-50C1086.32,261.86,1076.24,245.46,1061.26,239.98z M981.32,322.66c-5.25,0-9.5-4.25-9.5-9.5
          c0-5.25,4.25-9.5,9.5-9.5s9.5,4.25,9.5,9.5C990.82,318.41,986.56,322.66,981.32,322.66z" />
            <circle class="logost0" cx="617.5" cy="226.03" r="11.5" />
            <path class="logost0" d="M1197.76,239.98c-1.17-0.43-2.47-0.79-3.86-1.1c-8.77-3.64-40.34-7.84-49.58-9.62c-8.13-1.57-15-7.71-15-16
          c0-8.28,6.71-14.99,14.98-15h46.02v-30h-45.95c-0.02,0-0.03,0-0.05,0c-0.01,0-0.03,0-0.04,0h-0.8v0.02
          c-24.46,0.45-44.16,20.41-44.16,44.98c0,22.8,16.97,40.63,38.96,43.58c0,0,0,0.01,0,0.01c0,0,23.52,3.43,34.54,5.41
          c11.02,1.98,18.5,8.83,18.5,18.5c0,9.66-8.83,17.5-18.5,17.5c-0.01,0-0.01,0-0.02,0h-45.87c0,0,0,0,0,0h-12.13
          c-0.16,0-0.32-0.02-0.48-0.02c-8.29,0-15,6.71-15,15c0,8.28,6.71,15,15,15v0.02h54.92c1.18,0.08,2.38,0.14,3.58,0.14
          c27.61,0,50-22.39,50-50C1222.82,261.86,1212.74,245.46,1197.76,239.98z" />
            <path class="logost0" d="M120.5,0.5c-66.27,0-120,53.73-120,120c0,0.01,0,0.03,0,0.04V424.4h38v0h26.09v-0.05
          c0.38,0.02,0.75,0.06,1.13,0.06c9.94,0,18-8.06,18-18c0-9.94-8.06-18-18-18c-0.38,0-0.75,0.03-1.13,0.06v-0.06H38.5V345.5h35.86
          v-0.07c0.47,0.04,0.94,0.07,1.42,0.07c9.94,0,18-8.06,18-18c0-9.94-8.06-18-18-18c-0.48,0-0.95,0.04-1.42,0.07v-0.07H38.5v-61h66.97
          v-38H38.5v-90v0c0-45.29,36.71-82,82-82s82,36.71,82,82v0v90h-67.03v38h67.03v42h-18.91c-10.49,0-19,8.51-19,19
          c0,10.49,8.51,19,19,19h18.91h22.27h15.73v-208C240.5,54.23,186.77,0.5,120.5,0.5z M183.59,321c-6.35,0-11.5-5.15-11.5-11.5
          c0-6.35,5.15-11.5,11.5-11.5s11.5,5.15,11.5,11.5C195.09,315.85,189.94,321,183.59,321z" />
        </svg>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        </ul>
        <form v-if="!state.userIdentity" class="d-flex">
          <button class="btn btn-outline-primary" type="submit" @click="login">Login</button>
        </form>

        <template v-else class="btn btn-outline-primary" type="submit" @click="logout">
          <ul class="nav nav-tabs" style="border: none !important;">
            <li class="nav-item dropdown" style="border: none !important; ">
              <a class="nav-link text-primary" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">
                <i v-if="!state.userIdentity.picture" class="fa fa-user-circle fa-2x" />
                <img v-else :src="state.userIdentity.picture" style="border-radius: 100%; width: 40px">
              </a>
              <ul class="dropdown-menu" style="width: 250px">
                <li><span class="dropdown-item text-secondary" href="#">{{ state.userIdentity.name }}</span></li>
                <li><hr class="dropdown-divider text-dark"></li>
                <li><a class="dropdown-item text-dark" href="#" @click.prevent="logout">Logout</a></li>
                <!-- <li><a class="dropdown-item text-dark" href="#">Another action</a></li>
                <li><a class="dropdown-item text-dark" href="#">Something else here</a></li> -->
                <!-- <li><hr class="dropdown-divider text-dark"></li>
                <li><a class="dropdown-item text-dark" href="#">Separated link</a></li> -->
              </ul>
            </li>
          </ul>
        </template>
      </div>
    </div>
  </nav>
</template>

<script setup lang="ts">
import { reactive } from 'vue';
import { starterKitIsConfiguredCorrectly, authressLoginClient } from '../authressClient';

interface State {
  userIdentity: any
};

const state = reactive<State>({ userIdentity: null });

const login = async () => {
  console.log('User logging in');
  await authressLoginClient.authenticate({});
  // WHY DOESN"T THIS BUTTON WORK!
};

const logout = async () => {
  console.log('User logging out');
  await authressLoginClient.logout(new URL(window.location.href).origin);
  state.userIdentity = null;
};


// const makeApiCallWithUserToken = async () => {
//   const userAccessToken = await authressLoginClient.ensureToken({});
//   try {
//     const result = await fetch('http://localhost:8081/api/endpoint', {
//       headers: {
//         Authorization: `Bearer ${userAccessToken}`,
//       },
//     });
//     console.log('API Call request', result);
//   } catch (error) {
//     console.error('Error calling API', error);
//   }
// }

if (starterKitIsConfiguredCorrectly) {
  authressLoginClient.userSessionExists().then((userIsLoggedIn: any) => {
    state.userIdentity = authressLoginClient.getUserIdentity();
    console.log('User is Logged In', userIsLoggedIn, state.userIdentity);
  });
}

</script>

<style lang="scss">
@import "bootstrap/scss/functions";
@import "bootstrap/scss/variables";


  .logost0 {
    fill: #FBAF0B;
    stroke: #1D2F3B;
    stroke-miterlimit: 10;
  }
  .dropdown-menu.show {
    left: -183px;
    a:hover {
      background-color: $primary;
    }
  }
</style>